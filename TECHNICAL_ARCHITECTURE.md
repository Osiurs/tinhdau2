KIáº¾N TRÃšC Ká»¸THáº¬T Dá»° ÃN TINH-DAU-2

## ğŸ—ï¸ KIáº¾N TRÃšC Tá»”NG THá»‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NGÆ¯á»œI DÃ™NG (BROWSER)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP Request
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WEB SERVER (Apache/Nginx)                    â”‚
â”‚                     + PHP 7.4+ Runtime                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pages      â”‚  â”‚   API        â”‚  â”‚   Auth       â”‚
â”‚   (PHP)      â”‚  â”‚   (AJAX)     â”‚  â”‚   (Session)  â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ - index.php  â”‚  â”‚ - search_*   â”‚  â”‚ - login.php  â”‚
â”‚ - admin/*    â”‚  â”‚ - update_*   â”‚  â”‚ - logout.php â”‚
â”‚ - danh_sach* â”‚  â”‚ - delete_*   â”‚  â”‚ - check_*    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      BUSINESS LOGIC LAYER      â”‚
        â”‚      (Models - PHP Classes)    â”‚
        â”‚                                â”‚
        â”‚ - TinhToanNhienLieu.php        â”‚
        â”‚ - DauTon.php                   â”‚
        â”‚ - HeSoTau.php                  â”‚
        â”‚ - KhoangCach.php               â”‚
        â”‚ - LuuKetQua.php                â”‚
        â”‚ - User.php                     â”‚
        â”‚ - LoaiHang.php                 â”‚
        â”‚ - CayXang.php                  â”‚
        â”‚ - TauPhanLoai.php              â”‚
        â”‚ - Logger.php                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      DATA ACCESS LAYER         â”‚
        â”‚      (CSV File I/O)            â”‚
        â”‚                                â”‚
        â”‚ - readCsv()                    â”‚
        â”‚ - writeCsv()                   â”‚
        â”‚ - appendCsv()                  â”‚
        â”‚ - updateCsv()                  â”‚
        â”‚ - deleteCsv()                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CSV    â”‚      â”‚ JSON   â”‚      â”‚ LOG    â”‚
    â”‚ Files  â”‚      â”‚ Files  â”‚      â”‚ Files  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ LAYER ARCHITECTURE

### 1. **Presentation Layer (Táº§ng Giao Diá»‡n)**

#### Pages (PHP Templates)
```
admin/
â”œâ”€â”€ index.php                    # Dashboard
â”œâ”€â”€ quan_ly_tau.php             # Quáº£n lÃ½ tÃ u
â”œâ”€â”€ quan_ly_dau_ton.php         # Quáº£n lÃ½ dáº§u tá»“n
â”œâ”€â”€ quan_ly_tuyen_duong.php     # Quáº£n lÃ½ tuyáº¿n Ä‘Æ°á»ng
â”œâ”€â”€ quan_ly_loai_hang.php       # Quáº£n lÃ½ loáº¡i hÃ ng
â”œâ”€â”€ quan_ly_cay_xang.php        # Quáº£n lÃ½ cÃ¢y xÄƒng
â”œâ”€â”€ quan_ly_user.php            # Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
â””â”€â”€ bao_cao_dau_ton.php         # BÃ¡o cÃ¡o dáº§u tá»“n

Public/
â”œâ”€â”€ index.php                    # Trang chá»§
â”œâ”€â”€ danh_sach_tau.php           # Danh sÃ¡ch tÃ u
â”œâ”€â”€ danh_sach_diem.php          # Danh sÃ¡ch Ä‘iá»ƒm
â””â”€â”€ lich_su.php                 # Lá»‹ch sá»­ giao dá»‹ch
```

---

### 2. **Application Layer (Táº§ng á»¨ng Dá»¥ng)**

#### API Endpoints (AJAX)
```
api/
â”œâ”€â”€ search_diem.php              # TÃ¬m kiáº¿m Ä‘iá»ƒm
â”œâ”€â”€ get_loai_hang.php            # Láº¥y loáº¡i hÃ ng
â”œâ”€â”€ get_ma_chuyen.php            # Láº¥y mÃ£ chuyáº¿n
â”œâ”€â”€ update_segment.php           # Cáº­p nháº­t Ä‘oáº¡n
â”œâ”€â”€ update_transfer.php          # Cáº­p nháº­t chuyá»ƒn dáº§u
â”œâ”€â”€ update_tinh_chinh.php        # Cáº­p nháº­t tÃ­nh chÃ­nh
â”œâ”€â”€ update_cay_xang.php          # Cáº­p nháº­t cÃ¢y xÄƒng
â”œâ”€â”€ delete_transfer.php          # XÃ³a chuyá»ƒn dáº§u
â”œâ”€â”€ delete_dau_ton.php           # XÃ³a dáº§u tá»“n
â”œâ”€â”€ move_segment.php             # Di chuyá»ƒn Ä‘oáº¡n
â”œâ”€â”€ save_order_overrides.php     # LÆ°u ghi Ä‘Ã¨ thá»© tá»±
â””â”€â”€ add_loai_hang.php            # ThÃªm loáº¡i hÃ ng
```

---

### 3. **Business Logic Layer (Táº§ng Logic Kinh Doanh)**

#### Core Models
```
models/
â”œâ”€â”€ TinhToanNhienLieu.php        # TÃ­nh toÃ¡n nhiÃªn liá»‡u
â”œâ”€â”€ DauTon.php                   # Quáº£n lÃ½ dáº§u tá»“n
â”œâ”€â”€ HeSoTau.php                  # Quáº£n lÃ½ há»‡ sá»‘ tÃ u
â”œâ”€â”€ KhoangCach.php               # Quáº£n lÃ½ khoáº£ng cÃ¡ch
â”œâ”€â”€ LuuKetQua.php                # LÆ°u káº¿t quáº£ tÃ­nh toÃ¡n
â”œâ”€â”€ User.php                     # Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
â”œâ”€â”€ LoaiHang.php                 # Quáº£n lÃ½ loáº¡i hÃ ng
â”œâ”€â”€ CayXang.php                  # Quáº£n lÃ½ cÃ¢y xÄƒng
â”œâ”€â”€ TauPhanLoai.php              # PhÃ¢n loáº¡i tÃ u
â””â”€â”€ Logger.php                   # Ghi log
```

---

### 4. **Data Access Layer (Táº§ng Truy Cáº­p Dá»¯ Liá»‡u)**

#### CSV File Operations
```
Data Access Methods:
â”œâ”€â”€ readCsv()                    # Äá»c file CSV
â”œâ”€â”€ writeCsv()                   # Ghi file CSV
â”œâ”€â”€ appendCsv()                  # ThÃªm dÃ²ng vÃ o CSV
â”œâ”€â”€ updateCsv()                  # Cáº­p nháº­t dÃ²ng CSV
â””â”€â”€ deleteCsv()                  # XÃ³a dÃ²ng CSV
```

---

### 5. **Data Layer (Táº§ng Dá»¯ Liá»‡u)**

#### CSV Files
```
data/
â”œâ”€â”€ users.csv                    # NgÆ°á»i dÃ¹ng
â”œâ”€â”€ dau_ton.csv                  # Dáº§u tá»“n
â”œâ”€â”€ cay_xang.csv                 # CÃ¢y xÄƒng
â”œâ”€â”€ loai_hang.csv                # Loáº¡i hÃ ng
â”œâ”€â”€ tau_phan_loai.csv            # PhÃ¢n loáº¡i tÃ u
â”œâ”€â”€ ket_qua_tinh_toan.csv        # Káº¿t quáº£ tÃ­nh toÃ¡n
â””â”€â”€ *.log                        # Log files

Root CSV Files:
â”œâ”€â”€ bang_he_so_tau_cu_ly_full_v2.csv  # Há»‡ sá»‘ tÃ u
â””â”€â”€ khoang_duong.csv             # Khoáº£ng cÃ¡ch
```

---

## ğŸ” SECURITY ARCHITECTURE

### Authentication Flow
```
Login Page
    â”‚
    â”œâ”€ Username + Password
    â”‚
    â–¼
User::authenticate()
    â”‚
    â”œâ”€ Kiá»ƒm tra username tá»“n táº¡i
    â”œâ”€ Verify password (password_verify)
    â””â”€ Tráº£ vá» User object
    â”‚
    â–¼
loginUser()
    â”‚
    â”œâ”€ Táº¡o session
    â”œâ”€ LÆ°u user ID
    â””â”€ LÆ°u role (admin/user)
    â”‚
    â–¼
Redirect to Home
    â”‚
    â””â”€ Chuyá»ƒn hÆ°á»›ng vá» index.php
```

---

## ğŸ”Œ API ARCHITECTURE

### RESTful API Endpoints

#### Search API
```
GET /api/search_diem.php
    â”œâ”€ Parameters:
    â”‚  â”œâ”€ q: keyword (string)
    â”‚  â””â”€ diem_dau: optional (string)
    â”‚
    â””â”€ Response:
       â””â”€ JSON array of points
```

#### CRUD API
```
POST /api/update_segment.php
    â”œâ”€ Body:
    â”‚  â”œâ”€ idx: index (int)
    â”‚  â”œâ”€ ten_tau: ship name (string)
    â”‚  â”œâ”€ diem_bat_dau: start point (string)
    â”‚  â”œâ”€ diem_ket_thuc: end point (string)
    â”‚  â””â”€ khoi_luong: weight (float)
    â”‚
    â””â”€ Response:
       â””â”€ JSON {status, message}
```

---

## ğŸ“Š DATABASE SCHEMA (CSV Format)

### users.csv
```
id | username | password | full_name | role | created_at | updated_at
1  | admin    | hash...  | Admin     | admin| 2024-01-01 | 2024-01-01
```

### dau_ton.csv
```
id   | ten_tau | ngay       | loai_giao_dich | so_luong_lit | ly_do | cay_xang
uuid | TÃ u 1   | 2024-01-01 | cap_them       | 1000         | ...   | CÃ¢y 1
```

### bang_he_so_tau_cu_ly_full_v2.csv
```
ten_tau | cu_ly_km | k_ko_hang | k_co_hang
TÃ u 1   | 50       | 0.8       | 0.9
```

### khoang_duong.csv
```
diem_dau | diem_cuoi | khoang_cach_km
HCM      | HÃ  Ná»™i    | 1200
```

---

## ğŸ“ TECHNOLOGY STACK SUMMARY

| Layer | Technology | Version |
|-------|-----------|---------|
| **Frontend** | HTML5, CSS3, Bootstrap | 5.3.0 |
| **Frontend** | JavaScript | Latest |
| **Frontend** | Font Awesome | 6.4.0 |
| **Backend** | PHP | 7.4+ |
| **Data Storage** | CSV Files | - |
| **Excel Export** | PHPOffice/PHPSpreadsheet | 1.29 |
| **Server** | Apache/Nginx | Latest |
| **Dependency Manager** | Composer | Latest |

---

**TÃ i Liá»‡u NÃ y ÄÆ°á»£c Táº¡o Bá»Ÿi:** Code-Based Analysis  
**NgÃ y Táº¡o:** 2024-12-03  
**PhiÃªn Báº£n:** 1.0



